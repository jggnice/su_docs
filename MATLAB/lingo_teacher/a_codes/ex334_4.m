% 大学数学实验2  p.59-60  教材例2(4) 在区间 [ 0, pi/4 ] 上计算 1/(1 - sin (x) )的积分，
% 精确值     I = sqrt(2) = 1.41421356237310
% n = 10, 20, 40, 80 时比较 梯形公式 与 辛普森公式 的误差与的关系
%
format long	% 以下结果显示为双精度格式

z = sqrt(2)
n0 = [10 20 40 80];

for k = 1: length(n0);
    n = n0(k); 
    h = pi/4/n;		% h = pi/4n 		
    x = 0 : h : pi/4;	
    y = 1./(1 - sin(x));

    nn = length(y); 	% nn = n+1

    z3 = trapz(y) * h;	% 用梯形公式 函数计算
    w3 = z3 - z;

    n1 = 2: 2 : n;	% 对应第1, 3, ..., 99点
    n2 = 3: 2 : n;	% 对应第2, 4, ..., 98点	
    z4 = ( y(1)+y(nn)+4*sum(y(n1)) +2*sum(y(n2)) )* h/3;	% 用p.55 (3.22)辛普森公式直接计算
   w4 = z4 - z;
    
    if k ==1 
       answ(:,k) = [ z3 0 w3 z4 0 w4 ]' ;
    else
       answ(:,k) = [ z3 answ(1,k-1)-z3 w3 z4 answ(4,k-1)-z4 w4 ]'
    end
end

format short
% 结果：p.62表6.4
% 1.41792841879407            1.41514380451868            1.41444621906099	        1.41427173256482
%  0  	  	            0.00278461427539689      0.000697585457691829   0.000174486496169912
% 0.00371485642097857     0.000930242145581683    0.000232656687889854   5.81701917199418e-005
% 1.41424531921812            1.41421559976021            1.41421369057509             1.41421357039943
%  0	                               2.97194579088611e-005  1.90918512288363e-006   1.20175663198552e-007
% 3.17568450247663e-005  2.03738711590518e-006  1.28201993021548e-007   8.02632982299656e-009
